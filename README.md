# yahoo-fantasy-ha
This is a Home Assistant integration for a Yahoo Fantasy league (only tested for fantasy football at the moment). This was something that I've been wanting for a long time, but was finally made possible with zero coding knowledge with the help of AI.

Disclaimer: I am not a programmer - all of this code was generated by Claude AI, so I cannot troubleshoot. Sorry :(

## Getting Started
In order to use this integration, you first need to create a custom App in the Yahoo Developer Network. This will allow you to get a Client ID (Consumer Key) and Client Secret (Consumer Secret) that you'll need to link your Yahoo data with Home Assistant. You'll also need a valid oauth.json file that contains your credentials, which you'll get afterwards by editing the yahoo_oauth_ha with your credentails after setting up the Yahoo App.
1. Using your Yahoo credentials, login to the Yahoo Developer Network.
2. Click "Create an App".
3. Give your app:
   
   a. Application Name - you can use something like "Home Assistant"
   
   b. Description - Describe your app

   c. Homepage URL - Use the URL for your Home Assistant instance

   d. Redirect URI(s) - I'm not sure if this matters for how this is built, but Yahoo requires this to be https. I use https://localhost:8080 and this works for me

   e. Oauth Client Type - Choose Confidential Client

   f. API Permissions - Select Fantasy Sports, then make sure to select Read permissions.

4. Click Create App

Once you create your Yahoo App, it should be assigned a Client ID and Client Secret which you'll need to generate your oauth.json file in the next step.

## Generating your oauth.json file
You'll need to enter the credentials from your app into the yahoo_oauth_ha.py in order to generate your file correctly. This will authenticate your requests to the Yahoo API. The oauth file will stay refreshed automatically, so once you set up the file, you shouldn't need to do this again.
1. Download the yahoo_oauth_ha.py and open it.
2. Replace YOUR_YAHOO_APP_CONSUMER_KEY with your Yahoo App's Client ID
3. Replace YOUR_YAHOO_APP_CONSUMER_SECRET with your Yahoo App's Client Secret
4. Replace YOUR_PATH_TO_OAUTH_FILE_LOCATION with a directory where you'd like your oauth.json file to save once you run the script.
5. Save and exit yahoo_oauth_ha.py.
6. Run yahoo_oauth_ha.py - I ran this is Windows PowerShell by using the command "python3" followed by the path to the yahoo_oauth_ha.py script. Your browser should open up with a Sharing Approval code that you'll need to copy and paste back into PowerShell where you'll be asked to "Enter Verifier:".
7. Once you've verified, your oauth.json file should be generated at the path you entered in step 3.
8. Move this oauth.json file to the path of your Home Assistant configuration.yaml file.

## Adding the integration to Home Assistant
1. Download the yahoo-fantasy directory and add it to your /custom_components directory.
2. Restart Home Assistant

## Configuration
You'll need to add the platform sensor to your Home Assistant sensors.yaml or configuration.yaml, depending on where you configure your sensors. 

Within your configuration.yaml, you'll need to add the platform "yahoo_fantasy" following configuration keys:

| YAML Name | Description | Valid Values |
| --- | --- | --- |
| game_key | The sport of the league you want to integrate | I've only tried nfl, but I'd imagine nhl or mlb could also work |
| league_id | Yahoo's ID for your fantasy league | Go to your fantasy team's page through the Yahoo UI and note the URL: it should look something like "https://football.fantasysports.yahoo.com/f1/{league_id}/{team_id}" |
| team_id | Yahoo's ID for your team within your fantasy league | Go to your fantasy team's page through the Yahoo UI and note the URL: it should look something like "https://football.fantasysports.yahoo.com/f1/{league_id}/{team_id}" |

Here's an example of what to add to your configuration.yaml:
```
- platform: yahoo_fantasy
  game_key: nfl
  league_id: {league_id}
  team_id: {team_id}
```
Restart Home Assistant and you should be all set!

## Sensor Data
The entity created in Home Assistant includes many different attributes: the primary state is your team's score for the week, with attributes for both yours and your opponent's roster (with an is_starting attribute to designate players in your starting lineup).

## Add your matchup to your Dashboard
I also made a dashboard card that shows your matchup info (it shows your team and score vs your opponent with team logos, and starting lineup info with player headshots).
1. Download yahoo_fantasy_card.js
2. Add it to your /www/community directory
3. In Home Assistant, go to Settings > Dashboards > click the 3 dots in the top right and click Resources
4. Click "+ Add Resource"
5. For the URL, type "/local/community/yahoo_fantasy_card.js". It should be detected as a JavaScript Module.
6. Add the card to your Dashboard

You can configure the card like this:
```
type: custom:yahoo-fantasy-matchup-card
entity: sensor.yahoo_fantasy_matchup
```
You can also optionally show or hide both teams' bench players by adding this to your card configuration:
```
show_bench: true
```
